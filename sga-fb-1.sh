#!/bin/sh
# 426	2015-10-16	WMBC Food/Candy Fund	WMBC	Drew Spera	dre2@umbc.edu
curl http://osl.umbc.edu/sga/fb/ | grep reqDate\" -A 4 | perl -ne'BEGIN {$/ = "--"; $\ = "\n"; $" = "\t"} s/^\s*<td.*?>/\t/mg; s/<\/td>\n//g; s/--$//; s/^([^<]*)<a href="fb\/(\d*)">([^\t]*)<\/a>/$2$1$3/g; print' > fbPending.tsv
curl http://osl.umbc.edu/sga/heard | grep reqDate\" -A 4 | perl -ne'BEGIN {$/ = "--"; $\ = "\n"; $" = "\t"} s/^\s*<td.*?>/\t/mg; s/<\/td>\n//g; s/--$//; s/^([^<]*)<a href="fb\/(\d*)">([^\t]*)<\/a>/$2$1$3/g; print' > fbHeard.tsv
curl http://osl.umbc.edu/sga/tabled | grep reqDate\" -A 4 | perl -ne'BEGIN {$/ = "--"; $\ = "\n"; $" = "\t"} s/^\s*<td.*?>/\t/mg; s/<\/td>\n//g; s/--$//; s/^([^<]*)<a href="fb\/(\d*)">([^\t]*)<\/a>/$2$1$3/g; print' > fbTabled.tsv
echo "CREATE TABLE IF NOT EXISTS request ( id integer PRIMARY KEY ASC, legislation_id text, submitted date, organization text, legislation_introduced date, legislation_author text, abstained integer, favored integer, opposed integer, absent integer, legislation_voted date, name text, date_from date, date_to date, location text, outside_funding text, cosponsor text, approved date, description text, officer_phone text, officer_email text, officer_name text, officer_position text, attendees_other integer, attendees_umbc integer, charge_other integer, charge_umbc integer);" | sqlite3 osl.sqlite -batch
cat fb*.tsv | perl -ne'@_ = split "\t"; print qq{INSERT OR REPLACE INTO request (id, submitted, name, organization, officer_name, officer_email) VALUES ("$_[0]", "$_[1]", "$_[2]", "$_[3]", "$_[4]", "$_[5]");\n}'| sqlite3 osl.sqlite -batch
